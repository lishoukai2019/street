<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dao.OrderDao">
	<select id="queryOrderList" resultMap="orderMap">
		SELECT
		user_name,order_id,service_id,tb_order.user_id,service_count,order_status,tb_order.create_time,over_time,service_name,order_price
		FROM
		tb_order
		LEFT JOIN tb_person_info
		ON tb_order.user_id=tb_person_info.user_id
		<where>
			<if test="orderCondition.orderStatus != null">
				and order_status= #{orderCondition.orderStatus}
			</if>
			<if
				test="orderCondition.userId != null">
				and tb_order.user_id = #{orderCondition.userId}
			</if>
			<if
					test="orderCondition.orderId != null">
				and order_id = #{orderCondition.orderId}
			</if>
			<if
				test="orderCondition.serviceId != null">
				and service_id = #{orderCondition.serviceId}
			</if> 
			<if test="orderCondition.serviceName != null">
				and service_name like '%${orderCondition.serviceName}%'
			</if>
			<if test="orderCondition.createTime != null">
			    and DATE_FORMAT(create_time,'%Y %m %d') &gt;=  DATE_FORMAT(#{orderCondition.createTime},'%Y %m %d')
		   </if>
			<if test="orderCondition.overTime != null">
			    and DATE_FORMAT(over_time,'%Y %m %d') &gt;=  DATE_FORMAT(#{orderCondition.overTime},'%Y %m %d')
		</if>
		</where>
		<if test="sort != null and order != null">
			ORDER BY ${sort} ${order}
		</if>
		<if test="sort == null and order == null">
			ORDER BY tb_order.create_time desc
		</if>
		LIMIT #{rowIndex},#{pageSize};
	</select>

	<select id="queryOrderList2" resultMap="orderMap">
		SELECT
		order_id,service_id,user_id,service_count,order_status,create_time,over_time,service_name,order_price
		FROM
		tb_order
		<where>
			<if test="orderCondition.orderStatus != null">
				and order_status= #{orderCondition.orderStatus}
			</if>
			<if
					test="orderCondition.userId != null">
				and user_id = #{orderCondition.userId}
			</if>
			<if
					test="orderCondition.serviceId != null">
				and service_id = #{orderCondition.serviceId}
			</if>
			<if test="orderCondition.serviceName != null">
				and service_name like '%${orderCondition.serviceName}%'
			</if>
			<if test="orderCondition.createTime != null">
				and DATE_FORMAT(create_time,'%Y %m %d') &gt;=  DATE_FORMAT(#{orderCondition.createTime},'%Y %m %d')
			</if>
			<if test="orderCondition.overTime != null">
				and DATE_FORMAT(over_time,'%Y %m %d') &gt;=  DATE_FORMAT(#{orderCondition.overTime},'%Y %m %d')
			</if>
			<if test="orderCondition.isDelete != null">
				and is_delete = #{orderCondition.isDelete}
			</if>

		</where>
		ORDER BY create_time desc
	</select>

	<insert id="insertOrder" parameterType="com.entity.OrderInfo"
		useGeneratedKeys="true" keyProperty="orderId" keyColumn="order_id">
		INSERT
		INTO
		tb_order(service_id,user_id,service_count,order_status,create_time,over_time,service_name,order_price)
		VALUES
		(#{serviceId},#{userId},#{serviceCount},#{orderStatus},#{createTime},#{overTime},#{serviceName},#{orderPrice})
	</insert>

	
	<update id="updateOrder" parameterType="com.entity.OrderInfo">
		update tb_order 
		<set>
            <if test="serviceId!= null">service_id=#{serviceId},</if>
			<if test="userId != null">user_id=#{userId},</if>
			<if test="serviceCount != null">service_count=#{serviceCount},</if>
			<if test="orderStatus != null">order_status=#{orderStatus},</if>
			<if test="createTime!=null">create_time=#{createTime},</if>
			<if test="overTime!= null">over_time=#{overTime},</if>
			<if test="serviceName!= null">service_name=#{serviceName},</if>
			<if test="orderPrice!= null">order_price=#{orderPrice},</if>
			<if test="isDelete!= null">is_delete=#{isDelete}</if>
		</set>
		where order_id=#{orderId}
	</update>

	<select id="queryByOrderId" resultMap="orderMap" parameterType="Long">
		SELECT
		order_id,service_id,user_id,service_count,order_status,create_time,over_time,service_name,order_price
		FROM
		tb_order 
		WHERE
		order_id=#{orderId}
	</select>

	<resultMap id="orderMap" type="com.entity.OrderInfo">
		<id property="orderId" column="order_id"/>
		<result property="serviceId" column="service_id"/>
		<result property="userId" column="user_id"/>
		<result property="serviceCount" column="service_count"/>
		<result property="orderStatus" column="order_status"/>
		<result property="createTime" column="create_time"/>
		<result property="overTime" column="over_time"/>
		<result property="serviceName" column="service_name"/>
		<result property="orderPrice" column="order_price"/>
		<result property="isDelete" column="is_delete"/>
	</resultMap>
</mapper>